<!DOCTYPE html>
<!--
    Copyright (c) 2012-2014 Adobe Systems Incorporated. All rights reserved.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<!-- Cache manifest only works on same domain :(-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, target-densitydpi=medium-dpi, user-scalable=0" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title class="momo-title">Loading</title>
    </head>
    <body>

        <div id="momo-main">
            <div class="momo-loading text-muted">
                <i class="fa fa-spinner fa-pulse fa-3x"></i>
                <p class="momo-loading-text">
                  Initialisation de l'application
                </p>
            </div>
        </div>

        <script type="text/x-tmpl" id="momo-first-launch-tmpl">
            <h1>Première utilisation</h1
            <p>
                Tirez vers le bas pour mettre à jour l'application
            </p>
        </script>

        <script type="text/x-tmpl" id="momo-icon-tmpl">
            {% if(o.icon.startsWith('http://') ||
                  o.icon.startsWith('https://') ||
                  o.icon.startsWith('file://') ||
                  o.icon.endsWith('.png') ||
                  o.icon.endsWith('.svg') ||
                  o.icon.endsWith('.ico') ||
                  o.icon.endsWith('.jpeg') ||
                  o.icon.endsWith('.jpg')){ %}
                <img src="{%= o.icon %}" height="{%= o.size %}" width="{%= o.size %}" />
            {% } else { %}
                <i class="fa fa-fw {%= o.icon %} {% if(o.size > 20){ %} fa-3x {% } %}"></i>
            {% } %}
        </script>

        <script type="text/x-tmpl" id="momo-header-tmpl">
            <div class="navbar-btn pull-left">
                {% if(o.id && o.id != 'home'){ %}
                    <a href="#" class="btn btn-default pull-left momo-back-btn" onclick="window.history.back(); return false;">
                        <span class="sr-only"> History back </span>
                        <i class="fa fa-chevron-left"></i>
                    </a>
                {% } %}
            </div>
            <div class="parent-navbar-brand">
            <span class="navbar-brand" href="#home">
                <span class="momo-icon">
                    {% var icon = o.icon || o.meta.icon; %}
                    {% if(icon){ %}
                        {%# tmpl('momo-icon-tmpl', { icon: icon, size: 20, header: true }) %}
                    {% } %}
                </span>
                <span class="momo-title">{%= o.title || o.meta.title %}</span>
            </span>
        </div>
        </script>

        <!-- Main Template -->
        <script type="text/x-tmpl" id="momo-main-tmpl">

            <!-- Pull to refresh container -->
            <div id="ptr">
                <span class="genericon genericon-next"></span>

                <div class="loading">
                    <span class="l" id="l1"></span>
                    <span class="l" id="l2"></span>
                    <span class="l" id="l3"></span>
                    <span class="momo-loading-text"></span>
                </div>
            </div>

            <!-- Navbar -->
            <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
              <div class="container-fluid">
                <div class="navbar-header momo-header">
                  <div class="navbar-btn nav-toggle pull-right">
                      <button id="momo-menu-toggle" type="button" class="btn btn-default pull-right nav-toggle">
                          <i class="fa fa-bars fa-lg"></i>
                      </button>
                  </div>
                  <div class="navbar-header" id="momo-header">
                      {%# tmpl('momo-header-tmpl', o) %}
                  </div>
                </div>
                <div class="momo-nav-collapse">
                  <form id="momo-search" class="navbar-form navbar-right" role="search">
                    <div class="form-group">
                      <div class="input-group">
                        <input id="momo-search-input" name="searchInput" type="text" class="form-control" placeholder="Rechercher">
                        <div class="input-group-btn">
                          <button type="submit" class="btn btn-success">
                            <i class="fa fa-search"></i>
                            <!--span class="visible-xs-inline">Rechercher</span-->
                          </button>
                        </div>
                      </div>
                    </div>
                  </form>
                  <ul id="momo-menu" class="nav navbar-nav navbar-left"></ul>
                </div>
              </div>
            </nav>

            <!-- Pages List -->
            <div id="momo-pages"></div>

        </script>

        <script type="text/x-tmpl" id="momo-list-item-tmpl">
            <a href="#{%= o.id %}" class="{% if(!o.header){ %} list-group-item {% } %} clearfix">
                <span class="pull-left">
                {% if(o.icon){ %}
                    {%# tmpl('momo-icon-tmpl', { icon: o.icon, size: 20 }) %}
                {% } %}
                {%= o.title %}
                </span>
                {% if(o.external) { %}
                    <i class="fa fa-external-link pull-right"></i>
                {% } else { %}
                    <i class="fa fa-angle-right pull-right"></i>
                {% } %}
            </a>
        </script>

        <script type="text/x-tmpl" id="momo-icon-item-tmpl">
            <div class="col-xs-{%= o.colxs %} col-sm-{%= o.colsm %} col-md-{%= o.colmd %} col-lg-{%= o.collg %}">
                <a href="#{%= o.id %}" class="btn btn-block text-center {%= o.className || 'btn-default' %}">
                    {% if(o.external){ %}
                        <i class="fa fa-external-link top-right"></i>
                    {% } %}
                    {% if(o.icon){ %}
                        <div style="height: 42px;">
                            {%# tmpl('momo-icon-tmpl', { icon: o.icon, size: 42 }) %}
                        </div>
                    {% } %}
                    {%= o.title %}
                </a>
            </div>
        </script>

        <!-- Flash message template -->
        <script type="text/x-tmpl" id="momo-flash-message-tmpl">
            <div class="alert alert-{%= o.type %} pt-page-rotateRoomBottomIn">
                {%# o.message %}
            </div>
        </script>

        <!-- Update availbable template -->
        <script type="text/x-tmpl" id="momo-update-available-tmpl">
            <div class="clearfix">
                <a href="#momo-update" class="btn btn-success pull-right">
                   <i class="fa fa-download"></i>
                   Mettre à jour
                </a>
                <strong>Une nouvelle version est disponible !</strong>
            </div>
        </script>

        <!-- Page template -->
        <script type="text/x-tmpl" id="momo-page-tmpl">

            <div class="{% if(o.url){ %}momo-frame-wrapper{% } else { %}momo-page-wrapper{% } %} clearfix">
                <div class="momo-flash-messages"></div>
                       
                <div class="container-fluid">
                    <section class="momo-page-content">{%# o.content %}</section>
                </div>

                {% if(o.url){ %}
                    <iframe src="{%= o.url %}"></iframe>
                {% } %}
       
                {% if(o.pages){ %}
                    {% if(o.display == 'icons'){ %}
                        <div class="container-fluid tiny-gutters momo-page-pages">
                            {% for (var i = 0; i < o.pages.length; i++) { %}
                                {%# tmpl("momo-icon-item-tmpl", app.pages[o.pages[i]]) %}
                            {% } %}
                        </div>
                    {% } else { %}
                        <div class="list-group momo-page-pages">
                            {% for (var i = 0; i < o.pages.length; i++) { %}
                                {%# tmpl("momo-list-item-tmpl", app.pages[o.pages[i]]) %}
                            {% } %}
                        </div>

                    {% } %}
                {% } %}

                {% if(o.seealso){ %}
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Voir aussi
                            </div>
                            <div class="list-group momo-page-pages">
                                {% for (var i = 0; i < o.seealso.length; i++) { %}
                                    {%# tmpl("momo-list-item-tmpl", app.pages[o.seealso[i]]) %}
                                {% } %}
                            </div>
                        </div>
                    </div>
                {% } %}

            </div>
  
            <!-- Footer -->
            <footer class="navbar navbar-inverse momo-footer">
                <div class="container-fluid clearfix">
                    <div class="row">
                        <div class="col-xs-6 navbar-btn text-left">
                            <a href="https://dev.entrouvert.org/projects/momo/"
                                class="btn btn-success pull-left momo-repo" 
                                target="_system"
                                onclick="javascript:app.utils.onExternalLinkClick()">Momo repository</a>
                        </div>
                        <div class="col-xs-6 navbar-btn text-right">
                            <a href="mailto:{%= o.meta.contact %}" 
                                class="btn btn-success pull-right momo-contact">{%= o.meta.contact %}</a>
                        </div>
                    </div>
                </div>
            </footer>


        </script>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/polyfill/Promise.min.js"></script>
        <script type="text/javascript" src="js/polyfill/transition-end.min.js"></script>
        <script type="text/javascript" src="js/tmpl.min.js"></script>
        <script type="text/javascript" src="js/lunr.min.js"></script>
        <script type="text/javascript" src="js/lunr.stemmer.support.min.js"></script>
        <script type="text/javascript" src="js/lunr.fr.min.js"></script>
        <script type="text/javascript" src="js/hammer.min.js"></script>
        <script type="text/javascript" src="js/wptr.js"></script>
        <script type="text/javascript" src="js/fastclick.js"></script>
        <script type="text/javascript" src="js/responsive-nav.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
    </body>
</html>
